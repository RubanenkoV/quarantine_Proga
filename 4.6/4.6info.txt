Программа почти работает. По моему мнению, ход решения правильный, но до конечного результата дойти я так и не смог. 
На Еолимпе задачу не засчитывает. Но я старался.